<ul class="nav nav-tabs">
  <li class="nav-item">
    <%= link_to t(:all), organizacoes_path, :class => "nav-link" %>
  </li>
  <li class="nav-item">
    <%= link_to @local.nome, local_path(@local.id), :class => "nav-link active" %>
  </li>
</ul>

<br/>

<div class="tab-content" style="min-height: 64px;">
  <div class="tab-pane active">
    <center>
      <%= image_tag(@local.imagem.url(:medium), :width => "250") %>

      <br/><br/>
      <h3><%= @local.nome %></h3>

      <br/>
      <% if @local.observacao? %>
        <strong>Observação:</strong><br/><%= @local.observacao %>&nbsp;
      <% end %>

      <br/><br/>
      <strong>Responsável Pela Informação:</strong><br/><%= link_to @local.usuario.nome, usuario_path(@local.usuario) %>&nbsp;

      <% if @local.organizacoes.count > 0 %>
        <br/><br/>
        <strong>Organizações:</strong><br/><%= @local.organizacoes.map {|organizacao| link_to organizacao.nome, organizacao_path(organizacao)}.join(", ").html_safe %>&nbsp;
      <% end %>

      <% if @local.latitude and @local.longitude %>
        <br/><br/>
        <strong>Localização:</strong><br/>
        <div class="form-group row"><div id="map"></div></div>

        <script>
        $( document ).ready(function() {
          var map = L.map('map').setView([<%= @local.latitude %>, <%= @local.longitude %>], 10);
          L.tileLayer('https://a.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Agroecologia | OpenStreetMap', maxZoom: 18,}).addTo(map);
          var Icon = L.icon({
                            iconUrl: '<%= image_url "leaflet/images/leaf-green.png" %>',
                            shadowUrl: '<%= image_url "leaflet/images/leaf-shadow.png" %>',
                            iconSize:     [38, 95],
                            shadowSize:   [50, 64],
                            iconAnchor:   [22, 94],
                            shadowAnchor: [4, 62],
                            popupAnchor:  [-3, -76]
                          });
          $(window).on("resize", function () { $("#map").width($(window).width() - 30); map.invalidateSize(); }).trigger("resize");
          $(window).on("resize", function () { $("#map").height($(window).height()); map.invalidateSize(); }).trigger("resize");

          L.marker([<%= @local.latitude %>, <%= @local.longitude %>], {icon: Icon}).addTo(map);
        });
        </script>
    <% end %>
    </center>
    </div>
</div>

<% if usuario_signed_in? %>
<br/><br/>

  <% if current_usuario.admin? or current_usuario.id == @local.usuario.id %>        
    <div class="form-actions">
      <% if current_usuario.admin? or @local.usuario.id == current_usuario.id %>
        <%= link_to t('.edit', :default => "Editar"), edit_local_path(@local), :class => 'btn btn-warning' %>
        <%= link_to t(:destroy), local_path(@local), :method => 'delete', :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Você tem Certeza?')) }, :class => 'btn btn-danger' %>
      <% end %>
    </div>
  <% end %>
<% end %>
